{% extends "base.html" %}

{% block breadcrumb_items %}
  <li class="breadcrumb-item"><a href="{% url 'dashboard' %}">Home</a></li>
  <li class="breadcrumb-item active" aria-current="page">Patchset Detail</li>
{% endblock %}

{% block content %}
  <h1>Patch Set {{ patchset.patchwork_range_str|safe }}</h1>
  <dl>
    <div class="row">
      <dt class="col">Submitter</dt>
      <dd class="col-10">{{ patchset.submitter }}</dd>
    </div>
    <div class="row">
      <dt class="col">Baseline</dt>
      <dd class="col-10">
        {% if tarball.branch == 'dpdk' %}
        master
        {% else %}
        {{ tarball.branch }}
        {% endif %}
        (<a href="{{ tarball.commit_url }}">{{ tarball.commit_id }}</a>)
      </dd>
    </div>
    <div class="row">
      <dt class="col">Date Submitted</dt>
      <dd class="col-10">{{ patchset.date|date:"DATETIME_FORMAT" }}</dd>
    </div>
  </dl>
  <ul>
    {% for p in patchset.patches %}
    <li>
      <a href="https://dpdk.org/dev/patchwork/patch/{{ p.patchworks_id }}/">
        [PATCH {{ p.patch_number }}/{{ patchset.patches|length }}] {{ p.subject }}
      </a>
    </li>
    {% endfor %}
  </ul>
  <h1>Test Results</h1>
  <p>Overall result: <span class="{{ status_classes }}">{{ patchset.status }}</span></p>
  {% for env_url, r in runs.items %}
    <div class="card mb-4">
      <h2 class="card-header" id="env-{{ r.environment.id }}">
        {{ r.environment.nic_make }} {{ r.environment.nic_model }} {{ r.environment.nic_speed }} Mbps
      </h2>
      <div class="card-body">
        {% if 'url' not in r %}
        <p>The tests were not run for this environment.</p>
        {% else %}
          {% if not r.environment.live_since or r.environment.live_since > r.timestamp %}
          <p>Note: This run does not affect the overall result above.</p>
          {% endif %}
          {% if r.environment.hardware_description %}
          <h3><a href="{{ r.environment.hardware_description }}">Configuration Information</a></h3>
          {% else %}
          <h3>Configuration Information</h3>
          {% endif %}
          <dl>
            <div class="row">
            <dt class="col">Kernel</dt>
            <dd class="col-10">{{ r.environment.kernel_name }} {{ r.environment.kernel_version }}</dd>
            </div>
            <div class="row">
            <dt class="col">Compiler</dt>
            <dd class="col-10">{{ r.environment.compiler_name }} {{ r.environment.compiler_version }}</dd>
            </div>
            <div class="row">
            <dt class="col">Target</dt>
            <dd class="col-10">x86_64-native-linuxapp-gcc</dd>
            </div>
            <div class="row">
            <dt class="col">Fail/Total</dt>
            <dd class="col-10">{{ r.failure_count }}/{{ r.results|length }}</dd>
            </div>
          </dl>
          <h3>Detailed performance results</h3>
          <p>Test run at: {{ r.timestamp|date:"DATETIME_FORMAT" }}
            {% if request.user.is_superuser %}
            ({{ r.timedelta }} since patchset posted)
            {% endif %}
          </p>
          {% for tc in r.testcases.values %}
          <h4>Test Case: <a href="{{ tc.description_url }}">{{ tc.name }}</a></h4>
          <div class="table-responsive-sm">
            <table class="table table-hover">
              <thead>
                <tr>
                  <th>Result</th>
                  <th>{{ tc.results.0.measurement.parameters.frame_size.name }}
                  ({{ tc.results.0.measurement.parameters.frame_size.unit }})</th>
                  <th>{{ tc.results.0.measurement.parameters.txd_rxd.name }}
                  ({{ tc.results.0.measurement.parameters.txd_rxd.unit }})</th>
                  <th>{{ tc.results.0.measurement.name }} Difference
                  ({{ tc.results.0.measurement.unit }})</th>
                </tr>
              </thead>
              <tbody>
                {% for item in tc.results %}
                {% if not r.environment.live_since or r.environment.live_since > r.timestamp %}
                <tr class="table-secondary" title="This run does not affect the overall result above.">
                  <td class="text-{{ item.result_class }}">{{ item.result }}</td>
                {% else %}
                <tr class="table-{{ item.result_class }}">
                  <td>{{ item.result }}</td>
                {% endif %}
                  <td>{{ item.measurement.parameters.frame_size.value }}</td>
                  <td>{{ item.measurement.parameters.txd_rxd.value }}</td>
                  <td>{{ item.difference|floatformat:"-5" }}</td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
          {% if r.log_upload_file %}
          <p><a class="btn btn-info" href="{{ r.log_upload_file }}">Download test result artifacts</a></p>
          {% endif %}
          {% endfor %}
        {% endif %}
      </div>
    </div>
  {% empty %}
  <p>There are not yet any runs for this patch set or you do not have
  permission to view detailed results for any test runs for this patch
  set.</p>
  {% endfor %}
  {% if runs.items %}
  <h3>Disclaimers</h3>
  <p>The following disclaimer applies to Intel devices:</p>
  <blockquote class="blockquote text-muted border-left ml-4">
    <div class="ml-4">
      <p>
        <small>
          Software and workloads used in performance tests may have been
          optimized for performance only on Intel microprocessors.
        </small>
      </p>
      <p>
        <small>
          Performance tests, such as SYSmark and MobileMark, are measured using
          specific computer systems, components, software, operations and
          functions. Any change to any of those factors may cause the results
          to vary. You should consult other information and performance tests
          to assist you in fully evaluating your contemplated purchases,
          including the performance of that product when combined with other
          products. For more complete information visit
          <a href="https://www.intel.com/benchmarks/">www.intel.com/benchmarks</a>.
        </small>
      </p>
      <p>
        <small>
          Performance results are based on testing as of {{ patchset.date|date }}
          and may not reflect all publicly available security updates.
          See configuration disclosure for details.
          No product can be absolutely secure.
        </small>
      </p>
    </div>
  </blockquote>
  {% endif %}
{% endblock %}

{% block js %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.1.1/anchor.min.js" integrity="sha256-pB/deHc9CGfFpJRjC43imB29Rse8tak+5eXqntO94ck=" crossorigin="anonymous"></script>
<script>anchors.add('h2');</script>
{% endblock %}
