{% for env_url, environment in environments.items %}
<div class="card mb-4">
  <h2 class="card-header" id="env-{{ environment.id }}">{{ environment.name }}</h2>
  <div class="card-body">
    {% if 'url' not in r %}
    <p>The tests were not run for this environment.</p>
    {% else %}
    {% if not environment.live_since or environment.live_since > r.timestamp %}
    <p>Note: This run does not affect the overall result above.</p>
    {% endif %}
    {% if environment.hardware_description %}
    <h3><a href="{{ environment.hardware_description }}">Configuration Information</a></h3>
    {% else %}
    <h3>Configuration Information</h3>
    {% endif %}
    <dl>
      <div class="row">
        <dt class="col">Kernel</dt>
        <dd class="col-10">{{ environment.kernel_name }} {{ environment.kernel_version }}</dd>
      </div>
      <div class="row">
        <dt class="col">Compiler</dt>
        <dd class="col-10">{{ environment.compiler_name }} {{ environment.compiler_version }}</dd>
      </div>
    </dl>
    {% for tc_url, tc in environment.testcases.items %}
      {% if tc.runs|length > 1 %}
        <div class="card mb-4">
          <div class="card-header">
            <div class="d-flex flex-column justify-content-lg-between flex-lg-row">
              <h4 class="mb-lg-0">
                {% if tc.description_url %}
                  <a href="{{ tc.description_url }}">{{ tc.name }}</a>
                {% else %}
                  {{ tc.name }}
                {% endif %}
              </h4>
              <ul class="nav nav-tabs card-header-tabs ml-2">
                {% for r in tc.runs %}
                <li class="nav-item">
                  <a class="nav-link{{ forloop.first|yesno:' active,' }}" data-toggle="tab" href="#run-{{ r.id }}" role="tab" aria-controls="run-{{ r.id }}" aria-selected="{{ forloop.first|lower }}">
                    Run {{ forloop.revcounter }}
                  </a>
                </li>
                {% endfor %}
              </ul>
            </div>
          </div>
          <div class="card-body">
            <div class="tab-content">
              {% for r in tc.runs %}
              <div class="tab-pane fade{{ forloop.first|yesno:' show active,' }}" id="run-{{ r.id }}" role="tabpanel" aria-labelledby="run-{{ r.id }}-tab">
                {% include "test_run.html" %}
              </div>
              {% endfor %}
            </div>
          </div>
        </div>
      {% elif tc.runs|length == 1 %}
        <div class="card mb-4">
          <h4 class="card-header">
            {% if tc.description_url %}
              <a href="{{ tc.description_url }}">{{ tc.name }}</a>
            {% else %}
              {{ tc.name }}
            {% endif %}
          </h4>
          <div class="card-body">
            {% with tc.runs|first as r %}
              {% include "test_run.html" %}
            {% endwith %}
          </div>
        </div>
      {% endif %}
    {% empty %}
      <p>There are not yet any runs for this patch set.</p>
    {% endfor %}
  {% endif %}
  </div>
</div>
{% empty %}
<p>
  There are not yet any runs for this patch set or you do not have
  permission to view detailed results for any test runs for this patch
  set.
</p>
{% endfor %}
