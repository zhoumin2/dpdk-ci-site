# Generated by Django 2.0.6 on 2018-06-18 14:58

from django.db import migrations, models


def add_job_names(apps, schema_editor):
    """Add a profile for each user in the system."""
    Tarball = apps.get_model("results", "Tarball")
    db_alias = schema_editor.connection.alias
    for tarball in Tarball.objects.using(db_alias).iterator():
        if hasattr(tarball, 'patchset') and tarball.patchset is not None:
            tarball.job_name = 'Apply-One-Patch-Set'
        elif tarball.branch == 'dpdk-next-net':
            tarball.job_name = 'Get-DPDK-Next-Net'
        else:
            tarball.job_name = 'Get-Latest-Git-Master'
        tarball.save()


class Migration(migrations.Migration):

    dependencies = [
        ('results', '0008_auto_20180608_1809'),
    ]

    operations = [
        migrations.RenameField(
            model_name='tarball',
            old_name='job_id',
            new_name='build_id'),
        migrations.AlterField(
            model_name='tarball',
            name='build_id',
            field=models.PositiveIntegerField(blank=True, help_text='Jenkins build id that generated this tarball. This can be NULL if the tarball was manually created.', null=True, verbose_name='Jenkins build id'),
        ),
        migrations.AddField(
            model_name='tarball',
            name='job_name',
            field=models.CharField(blank=True, help_text='Name of Jenkins job that generated this tarball. This can be NULL if the tarball was manually created.', max_length=128, verbose_name='Jenkins job name'),
        ),
        migrations.RunPython(add_job_names, migrations.RunPython.noop),
    ]
