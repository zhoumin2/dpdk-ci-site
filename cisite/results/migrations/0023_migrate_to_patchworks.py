# Generated by Django 2.0.7 on 2018-07-30 18:38

# Modified migration file to copy patch fields to patchset

from django.db import migrations, models


def copy_patch_fields_to_patchset(apps, schema_editor):
    """Copy first patch fields to patchset."""
    db_alias = schema_editor.connection.alias
    PatchSet = apps.get_model('results', 'PatchSet')
    for patchset in PatchSet.objects.using(db_alias).all():
        patch = patchset.patches.first()
        patchset.completed_timestamp = patch.date
        patchset.pw_is_active = patch.pw_is_active
        patchset.save()


class Migration(migrations.Migration):

    dependencies = [
        ('results', '0022_auto_20180725_1910'),
    ]

    operations = [
        migrations.RemoveField(
            model_name='patchset',
            name='message_uid',
        ),
        migrations.RemoveField(
            model_name='patchset',
            name='patch_count',
        ),
        migrations.AddField(
            model_name='patchset',
            name='completed_timestamp',
            field=models.DateTimeField(blank=True, help_text='When this patchset was completed', null=True),
        ),
        migrations.AddField(
            model_name='patchset',
            name='pw_is_active',
            field=models.BooleanField(default=True, help_text='True if still considered active in Patchwork', verbose_name='Is active?'),
        ),
        migrations.RunPython(copy_patch_fields_to_patchset),
        migrations.DeleteModel(
            name='Patch',
        ),
    ]
